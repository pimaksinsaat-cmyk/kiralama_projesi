{% extends "base.html" %}

{% block content %}
<div class="container2">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h1>Kiralama Kayıtları</h1>
        
        <div style="display: flex; justify-content: flex-start; align-items: center; gap: 10px; margin-top: 20px;">
         <a href="{{ url_for('kiralama.ekle') }}" class="btn">Yeni Kiralama Ekle</a>
         <span>|</span>
         <a href="{{ url_for('main.index') }}">Ana Sayfaya Dön</a>
        </div>



    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="alert alert-{{ category }}">{{ message }}</div>
        {% endfor %}
      {% endif %}
    {% endwith %}
    <style>
        table { width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 0.9em; }
    </style>
    <table class="table table-striped table-bordered">
        <thead class="thead-dark">
            <tr>
                <th>Form No</th>
                <th>Müşteri</th>
                <th>Kiralanan Ekipmanlar</th>
                <th>Başlangıç Tarihleri</th>
                <th>Bitiş Tarihleri</th>
                <th>Birim Fiyatlar</th>
                <th>İşlemler</th>
            </tr>
        </thead>
        <tbody>
            {% if kiralamalar %}
                {% for kiralama in kiralamalar %}
                <tr>
                    
                    <td>
                        <a href="{{ url_for('kiralama.duzenle', kiralama_id=kiralama.id) }}">
                            {{ kiralama.kiralama_form_no }}
                        </a>
                    </td>
                    <td>{{ kiralama.musteri.firma_adi if kiralama.musteri else 'Müşteri Yok' }}</td>
                    
                    <td>
                        {% for kalem in kiralama.kalemler %}
                            {{ kalem.ekipman.kod if kalem.ekipman else 'Ekipman Yok' }}<br>
                        {% endfor %}
                    </td>
                    
                    <td>
                        {% for kalem in kiralama.kalemler %}
                            {{ kalem.kiralama_baslangıcı|tarihtr }}<br>
                        {% endfor %}
                    </td>

                    <td> {% for kalem in kiralama.kalemler %}
                            {{ kalem.kiralama_bitis|tarihtr }} <br>
                        {% endfor %}
                    </td>

                    <td>
                        {% for kalem in kiralama.kalemler %}
                            {{ kalem.kiralama_brm_fiyat }} TL<br>
                        {% endfor %}
                    </td>

                    <td>
                        <form action="{{ url_for('kiralama.sil', kiralama_id=kiralama.id) }}"
                         method="POST" 
                         style="display: inline;"
                         onsubmit="return confirm('Bu kiralama kaydını (ve tüm kalemlerini) silmek istediğinize emin misiniz?');">
    
                            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
    
                             <button type="submit" class="btn btn-danger2 btn-sm">
                              Sil
                             </button>
                         </form>
                        
                    </td>
                </tr>
                {% endfor %}
            {% else %}
                <tr>
                    <td colspan="6" class="text-center">Henüz kiralama kaydı bulunmuyor.</td>
                </tr>
            {% endif %}
        </tbody>
        
    </table>
</div>
{% endblock %}